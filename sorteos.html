<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sorteos | AlexDom104</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <style>
        :root { 
            --fondo: #333333; --contraste: #262626;
            --rosa-principal: #EF5085; --rosa-oscuro: #A64062;
            --cian-brillo: #70DDD8; --azul-boton: #0A315B;
        }
        body { font-family: 'Segoe UI', sans-serif; background: var(--fondo); color: white; text-align: center; padding: 20px; }
        
        .score-banner { background: var(--azul-boton); padding: 20px; border-radius: 15px; max-width: 400px; margin: 20px auto; border: 1px solid var(--cian-brillo); }
        .score-banner h2 { font-size: 2.5rem; color: var(--blanco); }

        .actions-list { max-width: 500px; margin: 0 auto; text-align: left; }
        .action-item { 
            background: var(--contraste); display: flex; align-items: center; justify-content: space-between; 
            padding: 15px 20px; border-radius: 12px; margin-bottom: 12px; border: 1px solid #444;
        }

        .btn-action { 
            background: var(--azul-boton); color: white; border: 1px solid var(--cian-brillo); 
            padding: 8px 18px; border-radius: 6px; cursor: pointer; text-decoration: none; font-size: 0.8rem; font-weight: bold;
        }
        
        /* Estado cuando está esperando que el usuario regrese */
        .waiting { background: #f1c40f; color: black; border-color: black; animation: pulse 1s infinite; }
        .completed { background: var(--rosa-oscuro) !important; border-color: var(--rosa-principal) !important; pointer-events: none; opacity: 0.7; }

        @keyframes pulse {
            0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; }
        }
    </style>
</head>
<body>

    <h1>Sorteo AlexDom104</h1>
    
    <div class="score-banner">
        <p>PUNTOS ACUMULADOS</p>
        <h2 id="totalPoints">0</h2>
        <button onclick="resetPoints()" style="background:none; border:none; color:grey; font-size:0.6rem; cursor:pointer;">(Reiniciar para pruebas)</button>
    </div>

    <div class="actions-list">
        <div class="action-item">
            <div><i class="fab fa-instagram"></i> Instagram (+1 pt)</div>
            <a href="https://instagram.com/AlexDom104" target="_blank" class="btn-action" id="btn-ig" onclick="startAction(1, 'btn-ig')">SEGUIR</a>
        </div>

        <div class="action-item">
            <div><i class="fab fa-discord"></i> Discord (+2 pts)</div>
            <a href="TU_LINK" target="_blank" class="btn-action" id="btn-dc" onclick="startAction(2, 'btn-dc')">UNIRME</a>
        </div>
        
        <p style="font-size: 0.8rem; color: #aaa; margin-top: 20px;">* El punto se otorga al regresar a esta pestaña tras realizar la acción.</p>
    </div>

    <script>
        let totalPoints = parseInt(localStorage.getItem('puntosSorteo')) || 0;
        let pendingPoints = 0;
        let activeBtnId = null;

        // Al cargar la página, ponemos los puntos que ya tenía
        document.getElementById('totalPoints').innerText = totalPoints;

        function startAction(pts, btnId) {
            const btn = document.getElementById(btnId);
            if (btn.classList.contains('completed')) return;

            pendingPoints = pts;
            activeBtnId = btnId;

            btn.innerText = "VERIFICANDO...";
            btn.classList.add('waiting');

            // Detectar cuando el usuario regresa a la pestaña
            window.addEventListener('focus', finishAction, { once: true });
        }

        function finishAction() {
            if (activeBtnId) {
                const btn = document.getElementById(activeBtnId);
                
                totalPoints += pendingPoints;
                
                // Guardar permanentemente en el navegador
                localStorage.setItem('puntosSorteo', totalPoints);
                
                document.getElementById('totalPoints').innerText = totalPoints;

                btn.innerText = "✓ COMPLETADO";
                btn.classList.remove('waiting');
                btn.classList.add('completed');

                // Guardar qué botones ya fueron pulsados
                localStorage.setItem(activeBtnId, 'true');

                activeBtnId = null;
                pendingPoints = 0;
            }
        }

        // Recuperar estado de los botones al recargar
        window.onload = () => {
            const botones = ['btn-ig', 'btn-dc']; // Añade aquí todos tus IDs
            botones.forEach(id => {
                if (localStorage.getItem(id) === 'true') {
                    const btn = document.getElementById(id);
                    if(btn) {
                        btn.innerText = "✓ COMPLETADO";
                        btn.classList.add('completed');
                    }
                }
            });
        };

        function resetPoints() {
            localStorage.clear();
            location.reload();
        }
    </script>
</body>
</html>
